name: Telegram Desktop (Windows) Intune App Package

on:
  workflow_dispatch:

jobs:
  package-telegram-desktop:
    runs-on: windows-latest

    steps:
      - name: ‚¨áÔ∏è Checkout repository
        uses: actions/checkout@v4

      - name: üìÇ Create working directories
        shell: pwsh
        run: |
          New-Item -ItemType Directory -Path ".\input" -ErrorAction SilentlyContinue
          New-Item -ItemType Directory -Path ".\output" -ErrorAction SilentlyContinue

      - name: üì• Download Telegram installer
        shell: pwsh
        run: |
          $installerUrl = "https://telegram.org/dl/desktop/win"
          $outputFile = ".\input\TelegramDesktopSetup.exe"
          Invoke-WebRequest -Uri $installerUrl -OutFile $outputFile -MaximumRedirection 5
          if (-not (Test-Path $outputFile)) { throw "Download failed: Installer not found" }
          $fileSize = (Get-Item $outputFile).Length
          if ($fileSize -lt 50000000) {
            Write-Warning "Downloaded installer size is suspiciously small."
          }

      - name: üîé Extract Telegram version
        id: get_version
        shell: pwsh
        run: |
          $installer = ".\input\TelegramDesktopSetup.exe"
          $version = (Get-Item $installer).VersionInfo.ProductVersion
          if (-not $version) { throw "Could not extract Telegram version" }
          echo "TELEGRAM_VERSION=$version
