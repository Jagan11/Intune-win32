stages:
  - package

variables:
  TELEGRAM_URL: "https://telegram.org/dl/desktop/win"  # Official Telegram Desktop download
  INSTALLER_NAME: "tsetup.exe"
  OUTPUT_DIR: "output"

package-telegram:
  stage: package
  tags:
    - windows
  script:
    - echo "ðŸ“¥ Downloading Telegram installer..."
    - powershell -Command "Invoke-WebRequest -Uri $env:TELEGRAM_URL -OutFile $env:INSTALLER_NAME"

    - echo "ðŸ“‚ Preparing directories..."
    - mkdir Telegram
    - move $env:INSTALLER_NAME Telegram\

    - echo "ðŸ“¦ Packaging with IntuneWinAppUtil..."
    - IntuneWinAppUtil.exe -c Telegram -s $env:INSTALLER_NAME -o $env:OUTPUT_DIR -q

    - echo "âœ… Telegram intunewin package created at $env:OUTPUT_DIR"

  artifacts:
    paths:
      - $OUTPUT_DIR/*.intunewin
    expire_in: 1 week
